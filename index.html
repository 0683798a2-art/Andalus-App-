<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø·Ø¹Ù… - Ø§Ù„Ø£Ù†Ø¯Ù„Ø³ (Ø§Ù„Ù…Ø·ÙˆØ±)</title>
    <style>
        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f0e6d4 0%, #e8dec7 50%, #f0e6d4 100%); 
            min-height: 100vh;
            direction: rtl;
            text-align: right;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        /* Ø§Ù„Ù€ Header Ø¨ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ù†Ø¯Ù„Ø³ */
        .header {
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5rem;
        }

        .restaurant-name {
            font-family: 'Arial Black', Gadget, sans-serif; 
            font-size: 2rem; 
            margin-top: 10px;
            color: transparent; 
            text-shadow: 
                0 0 5px rgba(255, 223, 0, 0.8), 
                2px 2px 4px rgba(0, 0, 0, 0.5); 
            background: linear-gradient(180deg, #ffeb3b 0%, #ffc107 50%, #ffb300 100%);
            -webkit-background-clip: text; 
            background-clip: text; 
            font-weight: 900;
        }
        
        .current-time {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 1rem;
            color: #ffe0b2;
        }
        
        /* ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ØªØ£Ø®ÙŠØ± Ø§Ù„Ø¹Ø§Ø¦Ù… */
        #delay-alert-box {
            display: none; 
            position: fixed;
            top: 10px;
            right: 10px;
            background: linear-gradient(45deg, #ff5722, #e64a19);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(255, 87, 34, 0.5);
            font-weight: 700;
            font-size: 1.1rem;
            z-index: 1000;
            border: 3px solid #ffccbc;
            animation: fadeIn 0.5s;
        }
        #delay-alert-box button {
            background: #fff;
            color: #ff5722;
            border: none;
            padding: 5px 10px;
            border-radius: 8px;
            margin-right: 15px;
            cursor: pointer;
            font-weight: 600;
        }
        @keyframes fadeIn {
            from {opacity: 0; transform: translateY(-20px);}
            to {opacity: 1; transform: translateY(0);}
        }

        /* Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ */
        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            flex: 1;
            padding: 18px;
            text-align: center;
            background: #f5f5f5;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            color: #666;
            margin-left: 5px;
        }

        .tab.active {
            background: white;
            color: #d32f2f; 
            border-bottom: 4px solid #d32f2f;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }
        
        h2 {
            color: #d32f2f;
            border-bottom: 2px solid #ffeb3b;
            padding-bottom: 10px;
            margin-bottom: 25px;
            font-size: 1.8rem;
        }

        /* Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± */
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 12px 15px;
            margin: 8px 0;
            border: 2px solid #ddd;
            border-radius: 12px;
            box-sizing: border-box;
            font-size: 16px;
        }

        .btn {
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin: 8px 0;
            transition: all 0.3s;
        }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¨Ø­Ø« */
        .search-form-buttons {
            display: flex;
            gap: 15px;
        }

        .search-form-buttons button {
            width: 50%;
            margin: 0;
            padding: 12px 20px;
        }

        #search-result {
            margin-top: 20px;
            padding: 20px;
            background: #fff3cd; 
            border: 2px solid #ffeeba;
            border-radius: 12px;
            font-size: 1rem;
            color: #856404;
            line-height: 2;
        }
        
        /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
        .table-container {
            overflow-x: auto;
            margin-top: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }

        th {
            background: linear-gradient(135deg, #d32f2f, #b71c1c); 
            color: white;
            font-weight: 700;
        }
        
        .status-btn {
            padding: 8px 15px;
            width: auto;
            margin: 5px 0;
            border-radius: 8px;
            font-size: 0.9rem;
            display: block; 
            text-align: center;
        }

        .status-btn.btn-complete {
            background: linear-gradient(135deg, #4CAF50, #388e3c);
            color: white;
        }
        
        .status-btn.btn-danger {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„ØªØ£Ø®ÙŠØ± */
        .performance-avg {
            font-size: 1.1rem;
            font-weight: bold;
            color: #d32f2f;
        }
        
        /* ØªÙ„ÙˆÙŠÙ† Ø§Ù„ØµÙÙˆÙ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© */
        .row-complete {
            background-color: #e8f5e9; /* Light Green */
        }
        .row-delayed {
            background-color: #ffcdd2; /* Light Red */
            border-right: 5px solid #d32f2f;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø¬ÙˆØ§Ù„Ø§Øª (Media Queries) */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            .tabs {
                flex-direction: column;
            }
            .tab {
                padding: 15px;
            }
            .tab-content {
                padding: 20px;
            }
            
            /* ØªØ­Ø³ÙŠÙ† ØªÙ†Ø§Ø³Ù‚ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
            .btn, .search-form-buttons button {
                width: 100%;
                margin: 8px 0;
            }
            .search-form-buttons {
                flex-direction: column;
            }
            
            /* Ø¬Ø¹Ù„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ† Ù…Ø±Ø¦ÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
            #crew-list-table td:nth-child(3) {
                white-space: nowrap; 
            }
            .status-btn {
                display: inline-block; 
                width: auto;
                margin: 2px 5px;
            }

            .developer-footer {
                padding: 20px;
            }
            
            #delay-alert-box {
                width: 90%;
                right: 5%;
                font-size: 1rem;
            }
        }
        
        /* Ø£Ù†Ù…Ø§Ø· ØªÙ„ÙˆÙŠÙ† Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ø­Ø§Ù„Ø© */
        .time-elapsed-warning {
            color: #FF5722; 
            font-weight: bold;
        }
        
        .time-elapsed-normal {
            color: #00796b; 
            font-weight: bold;
        }
        
        /* ğŸ’¡ Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙÙŠ Ø§Ù„Ø¨Ø­Ø« */
        .crew-name-highlight {
            color: #d32f2f; 
            font-weight: 900;
            font-size: 1.1rem;
        }
        
        /* --- Ø£Ù†Ù…Ø§Ø· Developer Footer Ø§Ù„Ù…Ù†Ø³ÙˆØ®Ø© --- */
        .developer-footer {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
            margin-top: 40px;
            position: relative;
            overflow: hidden;
        }

        .developer-footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image:svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><polygon points="0,0 100,0 80,100 0,100" fill="rgba(255,255,255,0.05)"/></svg>');
        }

        .developer-info {
            position: relative;
            z-index: 1;
        }

        .developer-name {
            font-size: 1.8rem;
            font-weight: 700;
            color: #3498db;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .developer-title {
            font-size: 1.1rem;
            color: #ecf0f1;
            margin-bottom: 15px;
        }

        .developer-contact {
            font-size: 0.9rem;
            color: #bdc3c7;
            font-style: italic;
        }
        /* ------------------------------------- */

        @media print {
            body {
                background: white !important;
                padding: 0 !important;
            }
            .container {
                box-shadow: none !important;
                border-radius: 0 !important;
                margin: 0 !important;
            }
            .tabs, .log-controls, .filter-group, .header, .developer-footer, .action-cell, #delay-alert-box {
                display: none !important;
            }
            #performance-log, #today-log {
                display: block !important;
                padding: 10px !important;
            }
            table {
                box-shadow: none !important;
            }
            th {
                background: #d32f2f !important;
                -webkit-print-color-adjust: exact;
                color: white !important;
            }
            h2 {
                color: #333 !important;
                border-bottom: 2px solid #ccc !important;
            }
        }
    </style>
</head>
<body>

<div id="delay-alert-box">
    âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ ØªØ£Ø®ÙŠØ±: Ø§Ù„ÙØ§ØªÙˆØ±Ø© <span id="alert-invoice-num"></span> Ù„Ù„Ø·Ø§ÙˆÙ„Ø© <span id="alert-table-num"></span> ØªØ¬Ø§ÙˆØ²Øª 15 Ø¯Ù‚ÙŠÙ‚Ø©!
    <button onclick="hideDelayAlert()">Ø­Ø³Ù†Ø§Ù‹</button>
</div>

<div class="container">
    
    <header class="header">
        <h1>Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø·Ø¹Ù… ğŸ“</h1>
        <div class="restaurant-name">Ù…Ø·Ø§Ø¹Ù… ÙˆØ¨Ø±ÙˆØ³Øª Ø§Ù„Ø£Ù†Ø¯Ù„Ø³ (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø·ÙˆØ±Ø©)</div>
        <div class="current-time" id="currentTime"></div>
    </header>

    <div class="tabs">
        <button class="tab active" onclick="showTab('invoice-entry')" id="btn-invoice">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
        <button class="tab" onclick="showTab('today-log')" id="btn-today">Ø³Ø¬Ù„ ÙÙˆØ§ØªÙŠØ± Ø§Ù„ÙŠÙˆÙ…</button>
        <button class="tab" onclick="authenticateAndShowTab('performance-log')" id="btn-log">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø£Ø±Ø´ÙŠÙ ÙˆØ£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†</button>
        <button class="tab" onclick="authenticateAndShowTab('crew-management')" id="btn-crew">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†</button>
    </div>

    <div id="invoice-entry" class="tab-content active">
        <h2>Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØ§Ù„Ø·Ø§ÙˆÙ„Ø©</h2>
        <input type="text" id="invoice-num" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©" inputmode="numeric" required>
        <input type="text" id="table-num" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©" inputmode="numeric" required>
        
        <label for="crew-select" style="display: block; margin-top: 15px; font-weight: 600;">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø§Ù„Ù…Ø³ØªÙ„Ù…:</label>
        <select id="crew-select" onchange="ØªØ¨Ø¯ÙŠÙ„_Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„_Ø§Ù„ÙŠØ¯ÙˆÙŠ()">
            </select>

        <label for="manual-crew" style="display:none; margin-top: 15px; font-weight: 600;">Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ù…Ø¨Ø§Ø´Ø± ÙŠØ¯ÙˆÙŠ (Ù…Ø³Ø§Ø¹Ø¯/Ø¹Ø§Ù…Ù„ Ø°Ø±ÙˆØ©):</label>
        <input type="text" id="manual-crew" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… Ø§Ù„ÙŠØ¯ÙˆÙŠ" style="display:none;" inputmode="text">
        
        <button onclick="ØªØ³Ø¬ÙŠÙ„_Ø§Ù„ÙØ§ØªÙˆØ±Ø©()" class="btn btn-success">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© âœ…</button>
        
        <hr style="margin: 30px 0; border-color: #eee;">

        <div class="search-form">
            <h2>Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ ğŸ”</h2>
            <input type="text" id="search-input" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø£Ùˆ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ù„Ù„Ø¨Ø­Ø«" inputmode="numeric">
            <div class="search-form-buttons">
                <button onclick="Ø§Ù„Ø¨Ø­Ø«_Ø§Ù„Ø³Ø±ÙŠØ¹('invoice')" class="btn-search-invoice">Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ø§Ù„ÙŠÙˆÙ… ÙÙ‚Ø·)</button>
                <button onclick="Ø§Ù„Ø¨Ø­Ø«_Ø§Ù„Ø³Ø±ÙŠØ¹('table')" class="btn-search-table">Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</button>
            </div>
            <p id="search-result" style="font-weight: bold; margin-top: 10px;"></p>
        </div>
    </div>
    
    <div id="today-log" class="tab-content" style="display:none;">
        <h2>Ø³Ø¬Ù„ ÙÙˆØ§ØªÙŠØ± Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ â˜€ï¸</h2>
        
        <div class="table-container">
            <table id="today-invoices-table">
                <thead>
                    <tr>
                        <th>Ø§Ù„ÙˆÙ‚Øª</th>
                        <th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                        <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</th>
                        <th>Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
                        <th>Ø§Ù„Ø²Ù…Ù† Ø§Ù„Ù…Ù†Ù‚Ø¶ÙŠ</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡</th> 
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
        <h3 id="today-stats" style="margin-top: 15px; color: #d32f2f;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0 ÙØ§ØªÙˆØ±Ø© Ø§Ù„ÙŠÙˆÙ…</h3>
    </div>
    
    <div id="performance-log" class="tab-content" style="display:none;">
        <h2>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø£Ø±Ø´ÙŠÙ ÙˆØ£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ† ğŸ“Š</h2>
        
        <div class="filter-group">
            <div class="filter-item">
                 <label for="filter-date">ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„Ø£Ø±Ø´ÙŠÙ):</label>
                 <select id="filter-date" onchange="ÙÙ„ØªØ±Ø©_Ø§Ù„ÙÙˆØ§ØªÙŠØ±()">
                    </select>
            </div>
            
            <div class="filter-item">
                 <label for="filter-crew-select">ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± (Ø¨Ø§Ù„Ø§Ø³Ù…):</label>
                 <select id="filter-crew-select" onchange="ÙÙ„ØªØ±Ø©_Ø§Ù„ÙÙˆØ§ØªÙŠØ±()">
                    </select>
            </div>
            
            <div class="filter-item">
                 <label for="filter-crew-id">ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± (Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ ID):</label>
                 <input type="text" id="filter-crew-id" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ù‡Ù†Ø§" oninput="ÙÙ„ØªØ±Ø©_Ø§Ù„ÙÙˆØ§ØªÙŠØ±()" style="width: 100%;">
            </div>

            <button onclick="ÙÙ„ØªØ±Ø©_Ø§Ù„ÙÙˆØ§ØªÙŠØ±()" class="btn">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ± ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª</button>
        </div>

        <h3 id="filtered-stats" style="margin-top: 15px; color: #155724;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0 ÙØ§ØªÙˆØ±Ø© Ù…ÙØ³Ø¬Ù„Ø©</h3>
        <p id="performance-summary" style="margin-top: 10px; padding: 15px; border-radius: 8px; background: #e0f7fa; border: 1px solid #b2ebf2;">
             **Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² (TAT):** <span class="performance-avg" id="avg-tat">--</span> | **Ù…ØªÙˆØ³Ø· Ø²Ù…Ù† Ø§Ù„ØªØ£Ø®ÙŠØ±:** <span class="performance-avg" id="avg-delay">--</span>
        </p>

        <div class="table-container">
            <table id="invoices-log-table">
                <thead>
                    <tr>
                        <th>Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                        <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</th>
                        <th>Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
                        <th>Ù…Ø¯Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² (Ø¯Ù‚ÙŠÙ‚Ø©)</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
        
        <div class="log-controls">
             <button onclick="exportDataToCSV()" class="btn btn-export">ØªØµØ¯ÙŠØ± ÙˆØªØ­Ù…ÙŠÙ„ (CSV) â¬‡ï¸</button>
             <button onclick="printInvoicesLog()" class="btn btn-print">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø³Ø¬Ù„</button>
             <button onclick="Ù…Ø³Ø­_Ø¬Ù…ÙŠØ¹_Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª()" class="btn btn-danger">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ØªØ­Ø°ÙŠØ±!)</button>
        </div>
    </div>


    <div id="crew-management" class="tab-content" style="display:none;">
        <h2>Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†</h2>
        <input type="text" id="new-crew-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¨Ø§Ø´Ø±" inputmode="text" required>
        <input type="text" id="new-crew-id" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ (ID)" required>
        <button onclick="Ø¥Ø¶Ø§ÙØ©_Ø¹Ø¶Ùˆ_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†()" class="btn btn-success">Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø´Ø± Ø¬Ø¯ÙŠØ¯ â•</button>

        <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h3>
        <div class="table-container">
            <table id="crew-list-table">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                        <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ (ID)</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
    </div>
    
    <div class="developer-footer">
        <div class="developer-info">
            <div class="developer-name">Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯ ÙØ±Ø¬</div>
            <div class="developer-title">Ù…Ø·ÙˆØ± ÙˆÙ…ØµÙ…Ù… Ø§Ù„Ù†Ø¸Ø§Ù…</div>
            <div class="developer-contact">ØªÙ… ØªØ·ÙˆÙŠØ± Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… Ø®ØµÙŠØµØ§Ù‹ Ù„Ù…Ø·Ø§Ø¹Ù… ÙˆØ¨Ø±ÙˆØ³Øª Ø§Ù„Ø£Ù†Ø¯Ù„Ø³</div>
        </div>
    </div>

</div>

<script>
    // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    const Ù…ÙØªØ§Ø­_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ† = 'restaurantCrew';
    const Ù…ÙØªØ§Ø­_Ø§Ù„ÙÙˆØ§ØªÙŠØ± = 'restaurantInvoices';
    const Ø­Ø¯_Ø§Ù„ØªØ£Ø®ÙŠØ±_Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ = 15; // Ø­Ø¯ Ø§Ù„ØªØ£Ø®ÙŠØ± Ù‡Ùˆ 15 Ø¯Ù‚ÙŠÙ‚Ø©
    const ADMIN_PIN = '1234'; // **Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ**

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ 12 Ø³Ø§Ø¹Ø© (Øµ/Ù…)
    const Ø®ÙŠØ§Ø±Ø§Øª_Ø§Ù„ØªØ§Ø±ÙŠØ® = {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: true, 
        calendar: 'gregory' 
    };

    // --- ÙˆØ¸Ø§Ø¦Ù Ø¹Ø§Ù…Ø© ÙˆÙ…Ø³Ø§Ø¹Ø¯Ø© ---
    
    function Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø³Ù„Ø³Ù„Ø©_ØªØ§Ø±ÙŠØ®_Ø§Ù„ÙØ§ØªÙˆØ±Ø©(Ø§Ù„Ù…Ø¯Ø®Ù„) {
        let ØªØ§Ø±ÙŠØ®;
        if (Ø§Ù„Ù…Ø¯Ø®Ù„ && Ø§Ù„Ù…Ø¯Ø®Ù„.recordedDate instanceof Date) {
            ØªØ§Ø±ÙŠØ® = Ø§Ù„Ù…Ø¯Ø®Ù„.recordedDate;
        } else if (Ø§Ù„Ù…Ø¯Ø®Ù„ instanceof Date) { 
            ØªØ§Ø±ÙŠØ® = Ø§Ù„Ù…Ø¯Ø®Ù„;
        } else {
            return '';
        }

        return ØªØ§Ø±ÙŠØ®.getFullYear() + '-' + 
               String(ØªØ§Ø±ÙŠØ®.getMonth() + 1).padStart(2, '0') + '-' + 
               String(ØªØ§Ø±ÙŠØ®.getDate()).padStart(2, '0');
    }

    function ØªØ­Ø¯ÙŠØ«_Ø§Ù„ÙˆÙ‚Øª_Ø§Ù„Ø­Ø§Ù„ÙŠ() {
        const Ø§Ù„Ø¢Ù† = new Date();
        const ØªØ§Ø±ÙŠØ®_Ù…ÙŠÙ„Ø§Ø¯ÙŠ = Ø§Ù„Ø¢Ù†.toLocaleDateString('ar-EG', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            calendar: 'gregory'
        });
        const ÙˆÙ‚Øª_Ù…ÙŠÙ„Ø§Ø¯ÙŠ = Ø§Ù„Ø¢Ù†.toLocaleTimeString('ar-EG', {
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: true
        });
        
        document.getElementById('currentTime').textContent = `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${ØªØ§Ø±ÙŠØ®_Ù…ÙŠÙ„Ø§Ø¯ÙŠ} | Ø§Ù„ÙˆÙ‚Øª: ${ÙˆÙ‚Øª_Ù…ÙŠÙ„Ø§Ø¯ÙŠ}`;
    }
    
    setInterval(ØªØ­Ø¯ÙŠØ«_Ø§Ù„ÙˆÙ‚Øª_Ø§Ù„Ø­Ø§Ù„ÙŠ, 1000);
    ØªØ­Ø¯ÙŠØ«_Ø§Ù„ÙˆÙ‚Øª_Ø§Ù„Ø­Ø§Ù„ÙŠ();
    
    function ØªÙ†Ø³ÙŠÙ‚_ÙØ±Ù‚_Ø§Ù„ÙˆÙ‚Øª(ØªØ§Ø±ÙŠØ®_Ø§Ù„ØªØ³Ø¬ÙŠÙ„, ØªØ§Ø±ÙŠØ®_Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„ = null) {
        const Ø§Ù„Ø¢Ù† = ØªØ§Ø±ÙŠØ®_Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„ ? ØªØ§Ø±ÙŠØ®_Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„ : new Date();
        const ÙØ±Ù‚_Ø¨Ø§Ù„Ù…Ù„ÙŠ_Ø«Ø§Ù†ÙŠØ© = Ø§Ù„Ø¢Ù†.getTime() - ØªØ§Ø±ÙŠØ®_Ø§Ù„ØªØ³Ø¬ÙŠÙ„.getTime();
        
        if (ÙØ±Ù‚_Ø¨Ø§Ù„Ù…Ù„ÙŠ_Ø«Ø§Ù†ÙŠØ© < 0) return '0 Ø¯Ù‚ÙŠÙ‚Ø© Ùˆ 0 Ø«Ø§Ù†ÙŠØ©'; 

        const ÙØ±Ù‚_Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ = Math.floor(ÙØ±Ù‚_Ø¨Ø§Ù„Ù…Ù„ÙŠ_Ø«Ø§Ù†ÙŠØ© / 1000);
        const Ø¯Ù‚Ø§Ø¦Ù‚ = Math.floor(ÙØ±Ù‚_Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ / 60);
        const Ø«ÙˆØ§Ù†ÙŠ = ÙØ±Ù‚_Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ % 60;
        
        const Ø³Ù„Ø³Ù„Ø©_ÙØ±Ù‚_Ø§Ù„ÙˆÙ‚Øª = `${Ø¯Ù‚Ø§Ø¦Ù‚} Ø¯Ù‚ÙŠÙ‚Ø© Ùˆ ${Ø«ÙˆØ§Ù†ÙŠ} Ø«Ø§Ù†ÙŠØ©`;
        
        const Ø­Ø¯_Ø§Ù„ØªØ£Ø®ÙŠØ±_Ù…Ù„ÙŠ_Ø«Ø§Ù†ÙŠØ© = Ø­Ø¯_Ø§Ù„ØªØ£Ø®ÙŠØ±_Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ * 60 * 1000;
        
        if (ØªØ§Ø±ÙŠØ®_Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„) {
            // Ø¥Ø°Ø§ ØªÙ… Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„ØŒ Ù†Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ ÙˆØ§Ù„Ø²Ù…Ù† Ø¨Ø¯ÙˆÙ† ÙØ¦Ø§Øª
            return `${Ø¯Ù‚Ø§Ø¦Ù‚} Ø¯Ù‚ÙŠÙ‚Ø© ${Ø«ÙˆØ§Ù†ÙŠ} Ø«Ø§Ù†ÙŠØ©`;
        } else {
             // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„ØŒ Ù†Ø³ØªØ®Ø¯Ù… ÙØ¦Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù„Ù„ØªØ­Ø°ÙŠØ±
            const Ø§Ø³Ù…_Ø§Ù„ÙØ¦Ø© = ÙØ±Ù‚_Ø¨Ø§Ù„Ù…Ù„ÙŠ_Ø«Ø§Ù†ÙŠØ© >= Ø­Ø¯_Ø§Ù„ØªØ£Ø®ÙŠØ±_Ù…Ù„ÙŠ_Ø«Ø§Ù†ÙŠØ© ? 'time-elapsed-warning' : 'time-elapsed-normal';
            return `<span class="${Ø§Ø³Ù…_Ø§Ù„ÙØ¦Ø©}">${Ø³Ù„Ø³Ù„Ø©_ÙØ±Ù‚_Ø§Ù„ÙˆÙ‚Øª}</span>`;
        }
    }


    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ (Local Storage) ---

    function Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ø§Ù„Ù…ÙØªØ§Ø­) {
        try {
            const Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª = localStorage.getItem(Ø§Ù„Ù…ÙØªØ§Ø­);
            const Ø§Ù„Ø¹Ù†Ø§ØµØ± = Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ? JSON.parse(Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª) : [];
            if (Ø§Ù„Ù…ÙØªØ§Ø­ === Ù…ÙØªØ§Ø­_Ø§Ù„ÙÙˆØ§ØªÙŠØ±) {
                return Ø§Ù„Ø¹Ù†Ø§ØµØ±.map(Ø§Ù„Ø¹Ù†ØµØ± => ({
                    ...Ø§Ù„Ø¹Ù†ØµØ±,
                    recordedDate: new Date(Ø§Ù„Ø¹Ù†ØµØ±.recordedDate || Ø§Ù„Ø¹Ù†ØµØ±.id),
                    // Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Date Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                    completedDate: Ø§Ù„Ø¹Ù†ØµØ±.completedDate ? new Date(Ø§Ù„Ø¹Ù†ØµØ±.completedDate) : null,
                    isCompleted: Ø§Ù„Ø¹Ù†ØµØ±.isCompleted === true 
                }));
            }
            return Ø§Ù„Ø¹Ù†Ø§ØµØ±;
        } catch (e) {
            console.error("Error reading Local Storage:", e);
            return [];
        }
    }

    function Ø­ÙØ¸_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ø§Ù„Ù…ÙØªØ§Ø­, Ø§Ù„Ø¹Ù†Ø§ØµØ±) {
        try {
            let Ø§Ù„Ø¹Ù†Ø§ØµØ±_Ù„Ù„Ø­ÙØ¸ = Ø§Ù„Ø¹Ù†Ø§ØµØ±;
            if (Ø§Ù„Ù…ÙØªØ§Ø­ === Ù…ÙØªØ§Ø­_Ø§Ù„ÙÙˆØ§ØªÙŠØ±) {
                Ø§Ù„Ø¹Ù†Ø§ØµØ±_Ù„Ù„Ø­ÙØ¸ = Ø§Ù„Ø¹Ù†Ø§ØµØ±.map(Ø§Ù„Ø¹Ù†ØµØ± => ({
                    ...Ø§Ù„Ø¹Ù†ØµØ±,
                    // Ø­ÙØ¸ ÙƒØ®ØªÙ… Ø²Ù…Ù†ÙŠ (timestamp)
                    recordedDate: Ø§Ù„Ø¹Ù†ØµØ±.recordedDate instanceof Date ? Ø§Ù„Ø¹Ù†ØµØ±.recordedDate.getTime() : Ø§Ù„Ø¹Ù†ØµØ±.recordedDate,
                    completedDate: Ø§Ù„Ø¹Ù†ØµØ±.completedDate instanceof Date ? Ø§Ù„Ø¹Ù†ØµØ±.completedDate.getTime() : Ø§Ù„Ø¹Ù†ØµØ±.completedDate
                }));
            }
            localStorage.setItem(Ø§Ù„Ù…ÙØªØ§Ø­, JSON.stringify(Ø§Ù„Ø¹Ù†Ø§ØµØ±_Ù„Ù„Ø­ÙØ¸));
        } catch (e) {
            console.error("Error saving to Local Storage:", e);
        }
    }
    
    // --- ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ† (Crew Management) ---

    function ØªØ­Ù…ÙŠÙ„_Ù‚Ø§Ø¦Ù…Ø©_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†() {
        const Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙˆÙ† = Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†);
        const ØªØ­Ø¯ÙŠØ¯_Ø§Ù„Ù…Ø¨Ø§Ø´Ø± = document.getElementById('crew-select');
        const ÙÙ„ØªØ±Ø©_ØªØ­Ø¯ÙŠØ¯_Ø§Ù„Ù…Ø¨Ø§Ø´Ø± = document.getElementById('filter-crew-select');
        const Ø¬Ø³Ù…_Ø¬Ø¯ÙˆÙ„_Ù‚Ø§Ø¦Ù…Ø©_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ† = document.querySelector('#crew-list-table tbody');

        ØªØ­Ø¯ÙŠØ¯_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù…Ø¨Ø§Ø´Ø± --</option><option value="MANUAL_CASHIER">ÙƒØ§Ø´ÙŠØ±/Ù…Ø¨Ø§Ø´Ø± ØºÙŠØ± Ù…Ø­Ø¯Ø¯</option><option value="manual">-- Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ÙŠØ¯ÙˆÙŠ --</option>';
        ÙÙ„ØªØ±Ø©_ØªØ­Ø¯ÙŠØ¯_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±.innerHTML = '<option value="">-- Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù…ÙŠØ¹ --</option>';
        Ø¬Ø³Ù…_Ø¬Ø¯ÙˆÙ„_Ù‚Ø§Ø¦Ù…Ø©_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†.innerHTML = '';

        Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙˆÙ†.forEach(Ø§Ù„Ø¹Ø¶Ùˆ => {
            // Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©)
            const Ø®ÙŠØ§Ø±_Ø¥Ø¯Ø®Ø§Ù„ = document.createElement('option');
            Ø®ÙŠØ§Ø±_Ø¥Ø¯Ø®Ø§Ù„.value = Ø§Ù„Ø¹Ø¶Ùˆ.id;
            Ø®ÙŠØ§Ø±_Ø¥Ø¯Ø®Ø§Ù„.textContent = `${Ø§Ù„Ø¹Ø¶Ùˆ.name} (${Ø§Ù„Ø¹Ø¶Ùˆ.id})`; // Ø¹Ø±Ø¶ Ø§Ù„Ù€ ID
            ØªØ­Ø¯ÙŠØ¯_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±.appendChild(Ø®ÙŠØ§Ø±_Ø¥Ø¯Ø®Ø§Ù„);
            
            // Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„ÙÙ„ØªØ±Ø© 
            const Ø®ÙŠØ§Ø±_ÙÙ„ØªØ±Ø© = document.createElement('option');
            Ø®ÙŠØ§Ø±_ÙÙ„ØªØ±Ø©.value = Ø§Ù„Ø¹Ø¶Ùˆ.id;
            Ø®ÙŠØ§Ø±_ÙÙ„ØªØ±Ø©.textContent = `${Ø§Ù„Ø¹Ø¶Ùˆ.name} (${Ø§Ù„Ø¹Ø¶Ùˆ.id})`;
            ÙÙ„ØªØ±Ø©_ØªØ­Ø¯ÙŠØ¯_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±.appendChild(Ø®ÙŠØ§Ø±_ÙÙ„ØªØ±Ø©);

            // Ù„Ø¬Ø¯ÙˆÙ„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†
            const ØµÙ = Ø¬Ø³Ù…_Ø¬Ø¯ÙˆÙ„_Ù‚Ø§Ø¦Ù…Ø©_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†.insertRow();
            ØµÙ.insertCell().textContent = Ø§Ù„Ø¹Ø¶Ùˆ.name;
            ØµÙ.insertCell().textContent = Ø§Ù„Ø¹Ø¶Ùˆ.id;
            const Ø®Ù„ÙŠØ©_Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ = ØµÙ.insertCell();
            const Ø²Ø±_Ø§Ù„Ø­Ø°Ù = document.createElement('button');
            Ø²Ø±_Ø§Ù„Ø­Ø°Ù.textContent = 'Ø­Ø°Ù';
            Ø²Ø±_Ø§Ù„Ø­Ø°Ù.className = 'status-btn btn-danger';
            Ø²Ø±_Ø§Ù„Ø­Ø°Ù.onclick = () => Ø­Ø°Ù_Ø¹Ø¶Ùˆ_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†(Ø§Ù„Ø¹Ø¶Ùˆ.id);
            Ø®Ù„ÙŠØ©_Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.appendChild(Ø²Ø±_Ø§Ù„Ø­Ø°Ù);
        });
    }

    function Ø¥Ø¶Ø§ÙØ©_Ø¹Ø¶Ùˆ_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†() {
        const Ø¥Ø¯Ø®Ø§Ù„_Ø§Ù„Ø§Ø³Ù… = document.getElementById('new-crew-name');
        const Ø¥Ø¯Ø®Ø§Ù„_Ø§Ù„Ø±Ù‚Ù… = document.getElementById('new-crew-id');
        const Ø§Ù„Ø§Ø³Ù… = Ø¥Ø¯Ø®Ø§Ù„_Ø§Ù„Ø§Ø³Ù….value.trim();
        const Ø§Ù„Ø±Ù‚Ù… = Ø¥Ø¯Ø®Ø§Ù„_Ø§Ù„Ø±Ù‚Ù….value.trim().toUpperCase();

        if (!Ø§Ù„Ø§Ø³Ù… || !Ø§Ù„Ø±Ù‚Ù…) {
            alert('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ (ID).');
            return;
        }

        let Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙˆÙ† = Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†);
        if (Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙˆÙ†.some(Ø§Ù„Ø¹Ø¶Ùˆ => Ø§Ù„Ø¹Ø¶Ùˆ.id === Ø§Ù„Ø±Ù‚Ù…)) {
            alert('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ (ID) Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹.');
            return;
        }

        Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙˆÙ†.push({ name: Ø§Ù„Ø§Ø³Ù…, id: Ø§Ù„Ø±Ù‚Ù… });
        Ø­ÙØ¸_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†, Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙˆÙ†);
        Ø¥Ø¯Ø®Ø§Ù„_Ø§Ù„Ø§Ø³Ù….value = '';
        Ø¥Ø¯Ø®Ø§Ù„_Ø§Ù„Ø±Ù‚Ù….value = '';
        alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­!');
        ØªØ­Ù…ÙŠÙ„_Ù‚Ø§Ø¦Ù…Ø©_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†();
    }

    function Ø­Ø°Ù_Ø¹Ø¶Ùˆ_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†(Ø§Ù„Ø±Ù‚Ù…) {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ØŸ')) return;
        let Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙˆÙ† = Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†);
        Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙˆÙ† = Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙˆÙ†.filter(Ø§Ù„Ø¹Ø¶Ùˆ => Ø§Ù„Ø¹Ø¶Ùˆ.id !== Ø§Ù„Ø±Ù‚Ù…);
        Ø­ÙØ¸_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†, Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙˆÙ†);
        alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¨Ø§Ø´Ø±.');
        ØªØ­Ù…ÙŠÙ„_Ù‚Ø§Ø¦Ù…Ø©_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†();
    }

    function ØªØ¨Ø¯ÙŠÙ„_Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„_Ø§Ù„ÙŠØ¯ÙˆÙŠ() {
        const ØªØ­Ø¯ÙŠØ¯_Ø§Ù„Ù…Ø¨Ø§Ø´Ø± = document.getElementById('crew-select');
        const Ø¥Ø¯Ø®Ø§Ù„_ÙŠØ¯ÙˆÙŠ = document.getElementById('manual-crew');
        const ØªØ³Ù…ÙŠØ©_ÙŠØ¯ÙˆÙŠØ© = document.querySelector('label[for="manual-crew"]');
        
        if (ØªØ­Ø¯ÙŠØ¯_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±.value === 'manual') {
            Ø¥Ø¯Ø®Ø§Ù„_ÙŠØ¯ÙˆÙŠ.style.display = 'block';
            ØªØ³Ù…ÙŠØ©_ÙŠØ¯ÙˆÙŠØ©.style.display = 'block';
            Ø¥Ø¯Ø®Ø§Ù„_ÙŠØ¯ÙˆÙŠ.focus();
        } else {
            Ø¥Ø¯Ø®Ø§Ù„_ÙŠØ¯ÙˆÙŠ.style.display = 'none';
            ØªØ³Ù…ÙŠØ©_ÙŠØ¯ÙˆÙŠØ©.style.display = 'none';
            Ø¥Ø¯Ø®Ø§Ù„_ÙŠØ¯ÙˆÙŠ.value = ''; 
        }
    }
    
    // --- ÙˆØ¸Ø§Ø¦Ù ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Invoice Entry) ---

    function ØªØ³Ø¬ÙŠÙ„_Ø§Ù„ÙØ§ØªÙˆØ±Ø©() {
        const Ø±Ù‚Ù…_Ø§Ù„ÙØ§ØªÙˆØ±Ø© = document.getElementById('invoice-num').value.trim();
        const Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø© = document.getElementById('table-num').value.trim();
        const ØªØ­Ø¯ÙŠØ¯_Ø§Ù„Ù…Ø¨Ø§Ø´Ø± = document.getElementById('crew-select');
        const Ù…Ø¨Ø§Ø´Ø±_ÙŠØ¯ÙˆÙŠ = document.getElementById('manual-crew').value.trim();

        let Ù…ÙØ¹Ø±Ù_Ø§Ù„Ù…Ø³ØªÙ„Ù…, Ø§Ø³Ù…_Ø§Ù„Ù…Ø³ØªÙ„Ù…;
        
        if (ØªØ­Ø¯ÙŠØ¯_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±.value === 'manual') {
            if (!Ù…Ø¨Ø§Ø´Ø±_ÙŠØ¯ÙˆÙŠ) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… Ø§Ù„ÙŠØ¯ÙˆÙŠ.');
                return;
            }
            Ù…ÙØ¹Ø±Ù_Ø§Ù„Ù…Ø³ØªÙ„Ù… = 'MANUAL_' + Date.now(); 
            Ø§Ø³Ù…_Ø§Ù„Ù…Ø³ØªÙ„Ù… = Ù…Ø¨Ø§Ø´Ø±_ÙŠØ¯ÙˆÙŠ;

        } else if (ØªØ­Ø¯ÙŠØ¯_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±.value === 'MANUAL_CASHIER') {
            Ù…ÙØ¹Ø±Ù_Ø§Ù„Ù…Ø³ØªÙ„Ù… = 'MANUAL_CASHIER';
            Ø§Ø³Ù…_Ø§Ù„Ù…Ø³ØªÙ„Ù… = 'ÙƒØ§Ø´ÙŠØ±/ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
        } else if (ØªØ­Ø¯ÙŠØ¯_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±.value) {
            const Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙˆÙ† = Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†);
            const Ø§Ù„Ø¹Ø¶Ùˆ_Ø§Ù„Ù…Ø­Ø¯Ø¯ = Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙˆÙ†.find(Ù… => Ù….id === ØªØ­Ø¯ÙŠØ¯_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±.value);
            Ù…ÙØ¹Ø±Ù_Ø§Ù„Ù…Ø³ØªÙ„Ù… = Ø§Ù„Ø¹Ø¶Ùˆ_Ø§Ù„Ù…Ø­Ø¯Ø¯.id;
            Ø§Ø³Ù…_Ø§Ù„Ù…Ø³ØªÙ„Ù… = Ø§Ù„Ø¹Ø¶Ùˆ_Ø§Ù„Ù…Ø­Ø¯Ø¯.name;
        } else {
            alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø£Ùˆ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø§Ù„Ù…Ø³ØªÙ„Ù….');
            return;
        }

        if (!Ø±Ù‚Ù…_Ø§Ù„ÙØ§ØªÙˆØ±Ø© || !Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø©) {
            alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØ±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©.');
            return;
        }
        
        const Ø§Ù„Ø¢Ù† = new Date();
        const Ø§Ù„Ø®ØªÙ…_Ø§Ù„Ø²Ù…Ù†ÙŠ = Ø§Ù„Ø¢Ù†.toLocaleString('ar-EG', Ø®ÙŠØ§Ø±Ø§Øª_Ø§Ù„ØªØ§Ø±ÙŠØ®); 

        const ÙØ§ØªÙˆØ±Ø©_Ø¬Ø¯ÙŠØ¯Ø© = {
            id: Date.now(),
            invoiceNum: Ø±Ù‚Ù…_Ø§Ù„ÙØ§ØªÙˆØ±Ø©,
            tableNum: Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø©,
            recipientID: Ù…ÙØ¹Ø±Ù_Ø§Ù„Ù…Ø³ØªÙ„Ù…,
            recipientName: Ø§Ø³Ù…_Ø§Ù„Ù…Ø³ØªÙ„Ù…,
            timestamp: Ø§Ù„Ø®ØªÙ…_Ø§Ù„Ø²Ù…Ù†ÙŠ, 
            recordedDate: Ø§Ù„Ø¢Ù†,
            isCompleted: false,
            timeToComplete: null, // Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø¬Ø¯ÙŠØ¯ Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²
            completedDate: null
        };

        let ÙÙˆØ§ØªÙŠØ± = Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„ÙÙˆØ§ØªÙŠØ±);
        ÙÙˆØ§ØªÙŠØ±.push(ÙØ§ØªÙˆØ±Ø©_Ø¬Ø¯ÙŠØ¯Ø©);
        Ø­ÙØ¸_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„ÙÙˆØ§ØªÙŠØ±, ÙÙˆØ§ØªÙŠØ±);

        alert(`ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ${Ø±Ù‚Ù…_Ø§Ù„ÙØ§ØªÙˆØ±Ø©} Ù„Ù„Ø·Ø§ÙˆÙ„Ø© ${Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø©} ÙˆØ§Ù„Ù…Ø¨Ø§Ø´Ø± ${Ø§Ø³Ù…_Ø§Ù„Ù…Ø³ØªÙ„Ù…}.`);

        document.getElementById('invoice-num').value = '';
        document.getElementById('table-num').value = '';
        ØªØ­Ø¯ÙŠØ¯_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±.value = '';
        document.getElementById('manual-crew').value = '';
        ØªØ¨Ø¯ÙŠÙ„_Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„_Ø§Ù„ÙŠØ¯ÙˆÙŠ();
        
        ØªØ­Ù…ÙŠÙ„_Ø³Ø¬Ù„_Ø§Ù„ÙŠÙˆÙ…();
        Ù…Ù„Ø¡_Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®_Ø§Ù„Ù…ØªØ§Ø­Ø©();
    }
    
    function ØªØ¹Ø¯ÙŠÙ„_Ø§Ù„ÙØ§ØªÙˆØ±Ø©(Ù…Ø¹Ø±Ù_Ø§Ù„ÙØ§ØªÙˆØ±Ø©, Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø©_Ø§Ù„Ø­Ø§Ù„ÙŠ, Ø±Ù‚Ù…_Ø§Ù„ÙØ§ØªÙˆØ±Ø©) {
        const Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø©_Ø§Ù„Ø¬Ø¯ÙŠØ¯ = prompt(`
            ØªØ¹Ø¯ÙŠÙ„ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ù„Ù„ÙØ§ØªÙˆØ±Ø©: ${Ø±Ù‚Ù…_Ø§Ù„ÙØ§ØªÙˆØ±Ø©}
            Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠ: ${Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø©_Ø§Ù„Ø­Ø§Ù„ÙŠ}

            Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯:
        `);

        if (Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø©_Ø§Ù„Ø¬Ø¯ÙŠØ¯ === null || Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø©_Ø§Ù„Ø¬Ø¯ÙŠØ¯.trim() === "") {
            return; 
        }
        
        const Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø©_Ø§Ù„Ù…ÙÙ†Ø¸Ù = Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø©_Ø§Ù„Ø¬Ø¯ÙŠØ¯.trim();
        
        if (Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø©_Ø§Ù„Ù…ÙÙ†Ø¸Ù === Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø©_Ø§Ù„Ø­Ø§Ù„ÙŠ) {
            alert('Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‡Ùˆ Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ. Ù„Ù… ÙŠØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ Ø£ÙŠ ØªØºÙŠÙŠØ±.');
            return;
        }

        let ÙÙˆØ§ØªÙŠØ± = Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„ÙÙˆØ§ØªÙŠØ±);
        const ÙÙ‡Ø±Ø³_Ø§Ù„ÙØ§ØªÙˆØ±Ø© = ÙÙˆØ§ØªÙŠØ±.findIndex(inv => inv.id === Ù…Ø¹Ø±Ù_Ø§Ù„ÙØ§ØªÙˆØ±Ø©); 

        if (ÙÙ‡Ø±Ø³_Ø§Ù„ÙØ§ØªÙˆØ±Ø© !== -1) {
            ÙÙˆØ§ØªÙŠØ±[ÙÙ‡Ø±Ø³_Ø§Ù„ÙØ§ØªÙˆØ±Ø©].tableNum = Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø©_Ø§Ù„Ù…ÙÙ†Ø¸Ù; 
            ÙÙˆØ§ØªÙŠØ±[ÙÙ‡Ø±Ø³_Ø§Ù„ÙØ§ØªÙˆØ±Ø©].modificationNote = `ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ù…Ù† ${Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø©_Ø§Ù„Ø­Ø§Ù„ÙŠ} Ø¥Ù„Ù‰ ${Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø©_Ø§Ù„Ù…ÙÙ†Ø¸Ù} (ÙÙŠ: ${new Date().toLocaleString('ar-EG', {hour: '2-digit', minute: '2-digit', hour12: true})})`;
            
            Ø­ÙØ¸_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„ÙÙˆØ§ØªÙŠØ±, ÙÙˆØ§ØªÙŠØ±);

            alert(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… ${Ø±Ù‚Ù…_Ø§Ù„ÙØ§ØªÙˆØ±Ø©}. Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‡Ùˆ: ${Ø±Ù‚Ù…_Ø§Ù„Ø·Ø§ÙˆÙ„Ø©_Ø§Ù„Ù…ÙÙ†Ø¸Ù}`);
            
            Ø¥Ø¹Ø§Ø¯Ø©_ØªØ­Ù…ÙŠÙ„_Ø§Ù„Ø³Ø¬Ù„_Ø§Ù„Ø­Ø§Ù„ÙŠ();

        } else {
            alert('âŒ Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙŠ Ø§Ù„Ø³Ø¬Ù„.');
        }
    }
    
    function Ø¥ÙƒÙ…Ø§Ù„_Ø§Ù„ÙØ§ØªÙˆØ±Ø©(Ù…Ø¹Ø±Ù_Ø§Ù„ÙØ§ØªÙˆØ±Ø©) {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ØºÙ„Ø§Ù‚ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ Ø³ÙŠØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØ£Ø®ÙŠØ± Ù„Ù‡.')) return;

        let ÙÙˆØ§ØªÙŠØ± = Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„ÙÙˆØ§ØªÙŠØ±);
        const ÙÙ‡Ø±Ø³_Ø§Ù„ÙØ§ØªÙˆØ±Ø© = ÙÙˆØ§ØªÙŠØ±.findIndex(inv => inv.id === Ù…Ø¹Ø±Ù_Ø§Ù„ÙØ§ØªÙˆØ±Ø©); 

        if (ÙÙ‡Ø±Ø³_Ø§Ù„ÙØ§ØªÙˆØ±Ø© !== -1) {
            const ÙØ§ØªÙˆØ±Ø© = ÙÙˆØ§ØªÙŠØ±[ÙÙ‡Ø±Ø³_Ø§Ù„ÙØ§ØªÙˆØ±Ø©];
            const Ø§Ù„Ø¢Ù† = new Date();
            
            // 1. Ø­Ø³Ø§Ø¨ ÙˆÙ‚Øª Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² (TAT)
            const ÙØ±Ù‚_Ø¨Ø§Ù„Ù…Ù„ÙŠ_Ø«Ø§Ù†ÙŠØ© = Ø§Ù„Ø¢Ù†.getTime() - ÙØ§ØªÙˆØ±Ø©.recordedDate.getTime();
            const Ø¯Ù‚Ø§Ø¦Ù‚_Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² = Math.round(ÙØ±Ù‚_Ø¨Ø§Ù„Ù…Ù„ÙŠ_Ø«Ø§Ù†ÙŠØ© / (60 * 1000));
            
            // 2. ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„
            ÙØ§ØªÙˆØ±Ø©.isCompleted = true; 
            ÙØ§ØªÙˆØ±Ø©.completionTime = Ø§Ù„Ø¢Ù†.toLocaleString('ar-EG', Ø®ÙŠØ§Ø±Ø§Øª_Ø§Ù„ØªØ§Ø±ÙŠØ®);
            ÙØ§ØªÙˆØ±Ø©.completedDate = Ø§Ù„Ø¢Ù†;
            ÙØ§ØªÙˆØ±Ø©.timeToComplete = Ø¯Ù‚Ø§Ø¦Ù‚_Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²; // Ø­ÙØ¸ ÙˆÙ‚Øª Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚

            // 3. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ£Ø®ÙŠØ± ÙˆØªØ®Ø²ÙŠÙ†Ù‡
            if (Ø¯Ù‚Ø§Ø¦Ù‚_Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² > Ø­Ø¯_Ø§Ù„ØªØ£Ø®ÙŠØ±_Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚) {
                 ÙØ§ØªÙˆØ±Ø©.wasDelayed = true;
            }
            
            Ø­ÙØ¸_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„ÙÙˆØ§ØªÙŠØ±, ÙÙˆØ§ØªÙŠØ±);

            alert(`âœ… ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø·Ù„Ø¨ Ø±Ù‚Ù… ${ÙØ§ØªÙˆØ±Ø©.invoiceNum} Ø¨Ù†Ø¬Ø§Ø­. Ù…Ø¯Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²: ${Ø¯Ù‚Ø§Ø¦Ù‚_Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²} Ø¯Ù‚ÙŠÙ‚Ø©.`);
            
            Ø¥Ø¹Ø§Ø¯Ø©_ØªØ­Ù…ÙŠÙ„_Ø§Ù„Ø³Ø¬Ù„_Ø§Ù„Ø­Ø§Ù„ÙŠ();
        }
    }
    
    function Ø¥Ø¹Ø§Ø¯Ø©_ØªØ­Ù…ÙŠÙ„_Ø§Ù„Ø³Ø¬Ù„_Ø§Ù„Ø­Ø§Ù„ÙŠ() {
        const ØªØ¨ÙˆÙŠØ¨_Ø§Ù„ÙŠÙˆÙ… = document.getElementById('today-log');
        const ØªØ¨ÙˆÙŠØ¨_Ø§Ù„Ø£Ø¯Ø§Ø¡ = document.getElementById('performance-log');
        
        if (ØªØ¨ÙˆÙŠØ¨_Ø§Ù„ÙŠÙˆÙ….classList.contains('active')) {
            ØªØ­Ù…ÙŠÙ„_Ø³Ø¬Ù„_Ø§Ù„ÙŠÙˆÙ…();
        } else if (ØªØ¨ÙˆÙŠØ¨_Ø§Ù„Ø£Ø¯Ø§Ø¡.classList.contains('active')) {
            ÙÙ„ØªØ±Ø©_Ø§Ù„ÙÙˆØ§ØªÙŠØ±(); 
        }
    }
    
    // --- ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹ Ø§Ù„Ù…ÙØ¹Ø¯Ù„Ø© (Ù„ØªÙ‚ØªØµØ± Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… ÙˆØªØ¸Ù‡Ø± Ø£Ø­Ø¯Ø« ØªØ³Ø¬ÙŠÙ„) ---
    function Ø§Ù„Ø¨Ø­Ø«_Ø§Ù„Ø³Ø±ÙŠØ¹(Ø§Ù„Ù†ÙˆØ¹) {
        const Ø¥Ø¯Ø®Ø§Ù„_Ø§Ù„Ø¨Ø­Ø« = document.getElementById('search-input').value.trim();
        const Ø¹Ø±Ø¶_Ø§Ù„Ù†ØªÙŠØ¬Ø© = document.getElementById('search-result');
        Ø¹Ø±Ø¶_Ø§Ù„Ù†ØªÙŠØ¬Ø©.textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„Ø¨Ø­Ø«...';

        if (!Ø¥Ø¯Ø®Ø§Ù„_Ø§Ù„Ø¨Ø­Ø«) {
            Ø¹Ø±Ø¶_Ø§Ù„Ù†ØªÙŠØ¬Ø©.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© Ù„Ù„Ø¨Ø­Ø«.';
            return;
        }

        const ÙÙˆØ§ØªÙŠØ±_Ù…Ø³Ø¬Ù„Ø© = Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„ÙÙˆØ§ØªÙŠØ±);
        let ÙØ§ØªÙˆØ±Ø©_Ù…ÙƒØªØ´ÙØ©;

        if (Ø§Ù„Ù†ÙˆØ¹ === 'invoice') {
            const Ø³Ù„Ø³Ù„Ø©_ØªØ§Ø±ÙŠØ®_Ø§Ù„ÙŠÙˆÙ… = Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø³Ù„Ø³Ù„Ø©_ØªØ§Ø±ÙŠØ®_Ø§Ù„ÙØ§ØªÙˆØ±Ø©(new Date());
            const ÙÙˆØ§ØªÙŠØ±_Ø§Ù„ÙŠÙˆÙ…_ÙÙ‚Ø· = ÙÙˆØ§ØªÙŠØ±_Ù…Ø³Ø¬Ù„Ø©.filter(inv => 
                Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø³Ù„Ø³Ù„Ø©_ØªØ§Ø±ÙŠØ®_Ø§Ù„ÙØ§ØªÙˆØ±Ø©(inv) === Ø³Ù„Ø³Ù„Ø©_ØªØ§Ø±ÙŠØ®_Ø§Ù„ÙŠÙˆÙ…
            );
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø­Ø¯Ø« ÙØ§ØªÙˆØ±Ø© Ù…Ø³Ø¬Ù„Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…
            ÙØ§ØªÙˆØ±Ø©_Ù…ÙƒØªØ´ÙØ© = ÙÙˆØ§ØªÙŠØ±_Ø§Ù„ÙŠÙˆÙ…_ÙÙ‚Ø·.slice().reverse().find(inv => inv.invoiceNum === Ø¥Ø¯Ø®Ø§Ù„_Ø§Ù„Ø¨Ø­Ø«); 
            
        } else if (Ø§Ù„Ù†ÙˆØ¹ === 'table') {
            // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© ÙŠØ¸Ù„ ÙƒÙ…Ø§ Ù‡Ùˆ (ÙŠØ¹Ø±Ø¶ Ø£Ø­Ø¯Ø« ØªØ³Ø¬ÙŠÙ„ Ù„Ù„Ø·Ø§ÙˆÙ„Ø© Ø£ÙŠØ§Ù‹ ÙƒØ§Ù† ØªØ§Ø±ÙŠØ®Ù‡)
            ÙØ§ØªÙˆØ±Ø©_Ù…ÙƒØªØ´ÙØ© = ÙÙˆØ§ØªÙŠØ±_Ù…Ø³Ø¬Ù„Ø©.slice().reverse().find(inv => inv.tableNum === Ø¥Ø¯Ø®Ø§Ù„_Ø§Ù„Ø¨Ø­Ø«);
        }

        if (ÙØ§ØªÙˆØ±Ø©_Ù…ÙƒØªØ´ÙØ©) {
            const Ø§Ø³Ù…_Ø§Ù„Ù…Ø³ØªÙ„Ù…_Ù…Ù†Ø³Ù‚ = `<span class="crew-name-highlight">${ÙØ§ØªÙˆØ±Ø©_Ù…ÙƒØªØ´ÙØ©.recipientName}</span>`;
            
            const Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ = ÙØ§ØªÙˆØ±Ø©_Ù…ÙƒØªØ´ÙØ©.modificationNote 
                ? `<br> **ØªØ¹Ø¯ÙŠÙ„ Ø³Ø§Ø¨Ù‚:** ${ÙØ§ØªÙˆØ±Ø©_Ù…ÙƒØªØ´ÙØ©.modificationNote}`
                : '';
            
            let Ø§Ù„Ø­Ø§Ù„Ø©;
            let ÙØ±Ù‚_Ø§Ù„ÙˆÙ‚Øª;
            
            if (ÙØ§ØªÙˆØ±Ø©_Ù…ÙƒØªØ´ÙØ©.isCompleted) {
                Ø§Ù„Ø­Ø§Ù„Ø© = `<span style="color: green;">Ù…ØºÙ„Ù‚/ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… (${ÙØ§ØªÙˆØ±Ø©_Ù…ÙƒØªØ´ÙØ©.timeToComplete} Ø¯Ù‚ÙŠÙ‚Ø©) ÙÙŠ: ${ÙØ§ØªÙˆØ±Ø©_Ù…ÙƒØªØ´ÙØ©.completionTime}</span>`;
                ÙØ±Ù‚_Ø§Ù„ÙˆÙ‚Øª = '';
            } else {
                const ÙØ±Ù‚_Ø§Ù„ÙˆÙ‚Øª_Ù…Ù†Ø³Ù‚ = ØªÙ†Ø³ÙŠÙ‚_ÙØ±Ù‚_Ø§Ù„ÙˆÙ‚Øª(ÙØ§ØªÙˆØ±Ø©_Ù…ÙƒØªØ´ÙØ©.recordedDate);
                Ø§Ù„Ø­Ø§Ù„Ø© = `<span style="color: red;">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° (ØªØ£Ø®ÙŠØ± Ù…Ø­ØªÙ…Ù„)</span>`;
                ÙØ±Ù‚_Ø§Ù„ÙˆÙ‚Øª = `<br> **Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ÙÙ†Ù‚Ø¶ÙŠ:** ${ÙØ±Ù‚_Ø§Ù„ÙˆÙ‚Øª_Ù…Ù†Ø³Ù‚}`;
            }

            Ø¹Ø±Ø¶_Ø§Ù„Ù†ØªÙŠØ¬Ø©.innerHTML = `
                Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: **${ÙØ§ØªÙˆØ±Ø©_Ù…ÙƒØªØ´ÙØ©.invoiceNum}**<br>
                Ø§Ù„Ø·Ø§ÙˆÙ„Ø©: **${ÙØ§ØªÙˆØ±Ø©_Ù…ÙƒØªØ´ÙØ©.tableNum}**<br>
                Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø§Ù„Ù…Ø³ØªÙ„Ù…: ${Ø§Ø³Ù…_Ø§Ù„Ù…Ø³ØªÙ„Ù…_Ù…Ù†Ø³Ù‚}<br>
                ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: ${ÙØ§ØªÙˆØ±Ø©_Ù…ÙƒØªØ´ÙØ©.timestamp}<br>
                **Ø§Ù„Ø­Ø§Ù„Ø©:** ${Ø§Ù„Ø­Ø§Ù„Ø©}
                ${ÙØ±Ù‚_Ø§Ù„ÙˆÙ‚Øª} 
                ${Ø§Ù„ØªØ¹Ø¯ÙŠÙ„}
            `;
            
        } else {
            const Ø±Ø³Ø§Ù„Ø©_Ø§Ù„Ø®Ø·Ø£ = (Ø§Ù„Ù†ÙˆØ¹ === 'invoice')
                ? `âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙØ§ØªÙˆØ±Ø© Ø¨Ø±Ù‚Ù… ${Ø¥Ø¯Ø®Ø§Ù„_Ø§Ù„Ø¨Ø­Ø«} ÙÙŠ Ø³Ø¬Ù„ **Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ**.`
                : `âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙØ§ØªÙˆØ±Ø© Ø¨Ø±Ù‚Ù… ${Ø¥Ø¯Ø®Ø§Ù„_Ø§Ù„Ø¨Ø­Ø«}.`;
                
            Ø¹Ø±Ø¶_Ø§Ù„Ù†ØªÙŠØ¬Ø©.textContent = Ø±Ø³Ø§Ù„Ø©_Ø§Ù„Ø®Ø·Ø£;
        }
    }
    
    function ØªØ­Ù…ÙŠÙ„_Ø³Ø¬Ù„_Ø§Ù„ÙŠÙˆÙ…() {
        const ÙÙˆØ§ØªÙŠØ± = Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„ÙÙˆØ§ØªÙŠØ±);
        const Ø³Ù„Ø³Ù„Ø©_ØªØ§Ø±ÙŠØ®_Ø§Ù„ÙŠÙˆÙ… = Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø³Ù„Ø³Ù„Ø©_ØªØ§Ø±ÙŠØ®_Ø§Ù„ÙØ§ØªÙˆØ±Ø©(new Date()); 
        
        const ÙÙˆØ§ØªÙŠØ±_Ø§Ù„ÙŠÙˆÙ… = ÙÙˆØ§ØªÙŠØ±.filter(inv => Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø³Ù„Ø³Ù„Ø©_ØªØ§Ø±ÙŠØ®_Ø§Ù„ÙØ§ØªÙˆØ±Ø©(inv) === Ø³Ù„Ø³Ù„Ø©_ØªØ§Ø±ÙŠØ®_Ø§Ù„ÙŠÙˆÙ…);
        
        Ø¹Ø±Ø¶_Ø§Ù„ÙÙˆØ§ØªÙŠØ±(ÙÙˆØ§ØªÙŠØ±_Ø§Ù„ÙŠÙˆÙ…, '#today-invoices-table tbody', true);
        
        document.getElementById('today-stats').textContent = `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${ÙÙˆØ§ØªÙŠØ±_Ø§Ù„ÙŠÙˆÙ….length} ÙØ§ØªÙˆØ±Ø© Ù…Ø³Ø¬Ù„Ø© Ø§Ù„ÙŠÙˆÙ….`;
    }
    
    function Ø¹Ø±Ø¶_Ø§Ù„ÙÙˆØ§ØªÙŠØ±(Ø§Ù„ÙÙˆØ§ØªÙŠØ±, Ù…ÙØ­Ø¯Ø¯_Ø§Ù„Ø¬Ø¯ÙˆÙ„, Ù‡Ùˆ_Ø³Ø¬Ù„_Ø§Ù„ÙŠÙˆÙ… = false) {
        const Ø¬Ø³Ù…_Ø¬Ø¯ÙˆÙ„_Ø§Ù„Ø³Ø¬Ù„ = document.querySelector(Ù…ÙØ­Ø¯Ø¯_Ø§Ù„Ø¬Ø¯ÙˆÙ„);
        Ø¬Ø³Ù…_Ø¬Ø¯ÙˆÙ„_Ø§Ù„Ø³Ø¬Ù„.innerHTML = '';
        
        Ø§Ù„ÙÙˆØ§ØªÙŠØ±.slice().sort((a, b) => b.id - a.id).forEach(ÙØ§ØªÙˆØ±Ø© => {
            const ØµÙ = Ø¬Ø³Ù…_Ø¬Ø¯ÙˆÙ„_Ø§Ù„Ø³Ø¬Ù„.insertRow();
            
            // **ØªØ­Ø³ÙŠÙ† ØªÙ„ÙˆÙŠÙ† Ø§Ù„ØµÙÙˆÙ**
            const Ù‡Ù„_Ù…ØªØ£Ø®Ø± = !ÙØ§ØªÙˆØ±Ø©.isCompleted && (new Date() - ÙØ§ØªÙˆØ±Ø©.recordedDate) > (Ø­Ø¯_Ø§Ù„ØªØ£Ø®ÙŠØ±_Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ * 60 * 1000);
            if (ÙØ§ØªÙˆØ±Ø©.isCompleted) {
                ØµÙ.classList.add('row-complete');
            } else if (Ù‡Ù„_Ù…ØªØ£Ø®Ø±) {
                ØµÙ.classList.add('row-delayed');
            }
            
            // 1. Ø®Ù„ÙŠØ© Ø§Ù„ÙˆÙ‚Øª/Ø§Ù„ØªØ§Ø±ÙŠØ®
            const Ø®Ù„ÙŠØ©_Ø§Ù„ÙˆÙ‚Øª = ØµÙ.insertCell();
            let Ù†Øµ_Ø§Ù„ÙˆÙ‚Øª;
            if (Ù‡Ùˆ_Ø³Ø¬Ù„_Ø§Ù„ÙŠÙˆÙ…) {
                Ù†Øµ_Ø§Ù„ÙˆÙ‚Øª = ÙØ§ØªÙˆØ±Ø©.timestamp.substring(ÙØ§ØªÙˆØ±Ø©.timestamp.lastIndexOf('|') + 1).trim();
            } else {
                Ù†Øµ_Ø§Ù„ÙˆÙ‚Øª = ÙØ§ØªÙˆØ±Ø©.timestamp;
            }
            Ø®Ù„ÙŠØ©_Ø§Ù„ÙˆÙ‚Øª.textContent = Ù†Øµ_Ø§Ù„ÙˆÙ‚Øª;
            
            // 2. Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØ§Ù„Ø·Ø§ÙˆÙ„Ø© ÙˆØ§Ù„Ù…Ø³ØªÙ„Ù…
            ØµÙ.insertCell().textContent = ÙØ§ØªÙˆØ±Ø©.invoiceNum;
            ØµÙ.insertCell().textContent = ÙØ§ØªÙˆØ±Ø©.tableNum;
            ØµÙ.insertCell().textContent = ÙØ§ØªÙˆØ±Ø©.recipientName;
            
            // 3. Ø®Ù„ÙŠØ© Ù…Ø¯Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²/Ø§Ù„Ù…Ù†Ù‚Ø¶ÙŠ (TAT)
            const Ø®Ù„ÙŠØ©_Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² = ØµÙ.insertCell();
            if (ÙØ§ØªÙˆØ±Ø©.isCompleted) {
                Ø®Ù„ÙŠØ©_Ø§Ù„Ø¥Ù†Ø¬Ø§Ø².textContent = `${ÙØ§ØªÙˆØ±Ø©.timeToComplete} Ø¯Ù‚ÙŠÙ‚Ø©`;
                if (ÙØ§ØªÙˆØ±Ø©.wasDelayed) {
                    Ø®Ù„ÙŠØ©_Ø§Ù„Ø¥Ù†Ø¬Ø§Ø².style.color = 'red';
                }
            } else {
                // Ø¹Ø±Ø¶ Ø§Ù„Ø²Ù…Ù† Ø§Ù„Ù…Ù†Ù‚Ø¶ÙŠ ÙˆØªÙ„ÙˆÙŠÙ†Ù‡
                Ø®Ù„ÙŠØ©_Ø§Ù„Ø¥Ù†Ø¬Ø§Ø².innerHTML = ØªÙ†Ø³ÙŠÙ‚_ÙØ±Ù‚_Ø§Ù„ÙˆÙ‚Øª(ÙØ§ØªÙˆØ±Ø©.recordedDate);
            }


            const Ø®Ù„ÙŠØ©_Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ = ØµÙ.insertCell();
            Ø®Ù„ÙŠØ©_Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.className = 'action-cell';
            
            if (!ÙØ§ØªÙˆØ±Ø©.isCompleted) {
                const Ø²Ø±_Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ = document.createElement('button');
                Ø²Ø±_Ø§Ù„ØªØ¹Ø¯ÙŠÙ„.textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© ğŸ“';
                Ø²Ø±_Ø§Ù„ØªØ¹Ø¯ÙŠÙ„.className = 'status-btn btn-print'; 
                Ø²Ø±_Ø§Ù„ØªØ¹Ø¯ÙŠÙ„.onclick = () => ØªØ¹Ø¯ÙŠÙ„_Ø§Ù„ÙØ§ØªÙˆØ±Ø©(ÙØ§ØªÙˆØ±Ø©.id, ÙØ§ØªÙˆØ±Ø©.tableNum, ÙØ§ØªÙˆØ±Ø©.invoiceNum); 
                Ø®Ù„ÙŠØ©_Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.appendChild(Ø²Ø±_Ø§Ù„ØªØ¹Ø¯ÙŠÙ„);
                
                const Ø²Ø±_Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„ = document.createElement('button');
                Ø²Ø±_Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„.textContent = 'Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø·Ù„Ø¨ âœ…';
                Ø²Ø±_Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„.className = 'status-btn btn-complete'; 
                Ø²Ø±_Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„.onclick = () => Ø¥ÙƒÙ…Ø§Ù„_Ø§Ù„ÙØ§ØªÙˆØ±Ø©(ÙØ§ØªÙˆØ±Ø©.id); 
                Ø®Ù„ÙŠØ©_Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.appendChild(Ø²Ø±_Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„);

            } else {
                 Ø®Ù„ÙŠØ©_Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.innerHTML = `<span style="color: green; font-size: 0.85rem;">ØªÙ… Ø§Ù„Ø¥ØºÙ„Ø§Ù‚</span>`;
            }
        });
    }
    
    // --- ÙˆØ¸Ø§Ø¦Ù Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØ£Ø®ÙŠØ± (ÙƒÙ…Ø§ Ù‡ÙŠ) ---
    
    function ØªÙ†Ø¨ÙŠÙ‡_Ø§Ù„ØªØ£Ø®ÙŠØ±(Ø§Ù„ÙØ§ØªÙˆØ±Ø©) {
        const ØµÙ†Ø¯ÙˆÙ‚_Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ = document.getElementById('delay-alert-box');
        document.getElementById('alert-invoice-num').textContent = Ø§Ù„ÙØ§ØªÙˆØ±Ø©.invoiceNum;
        document.getElementById('alert-table-num').textContent = Ø§Ù„ÙØ§ØªÙˆØ±Ø©.tableNum;
        ØµÙ†Ø¯ÙˆÙ‚_Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡.style.display = 'block';
    }
    
    function hideDelayAlert() {
        document.getElementById('delay-alert-box').style.display = 'none';
    }

    function Ø¨Ø¯Ø¡_Ù…Ø±Ø§Ù‚Ø¨_Ø§Ù„ØªØ£Ø®ÙŠØ±() {
        // Ø§Ù„ØªØ­Ù‚Ù‚ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ© Ù„ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
        setInterval(Ø§Ù„ØªØ­Ù‚Ù‚_Ù…Ù†_ØªØ£Ø®ÙŠØ±_Ø§Ù„ÙÙˆØ§ØªÙŠØ±, 30000); 
        Ø§Ù„ØªØ­Ù‚Ù‚_Ù…Ù†_ØªØ£Ø®ÙŠØ±_Ø§Ù„ÙÙˆØ§ØªÙŠØ±();
    }
    
    function Ø§Ù„ØªØ­Ù‚Ù‚_Ù…Ù†_ØªØ£Ø®ÙŠØ±_Ø§Ù„ÙÙˆØ§ØªÙŠØ±() {
        const ÙÙˆØ§ØªÙŠØ± = Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„ÙÙˆØ§ØªÙŠØ±);
        const Ø­Ø¯_Ø§Ù„ØªØ£Ø®ÙŠØ±_Ù…Ù„ÙŠ_Ø«Ø§Ù†ÙŠØ© = Ø­Ø¯_Ø§Ù„ØªØ£Ø®ÙŠØ±_Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ * 60 * 1000; 
        const Ø§Ù„Ø¢Ù† = new Date();
        let Ø­Ø¯Ø«_ØªØ£Ø®ÙŠØ± = false;
        
        ÙÙˆØ§ØªÙŠØ±.forEach(inv => {
            if (!inv.isCompleted) {
                const ÙØ±Ù‚_Ø§Ù„ÙˆÙ‚Øª = Ø§Ù„Ø¢Ù† - inv.recordedDate;
                
                if (ÙØ±Ù‚_Ø§Ù„ÙˆÙ‚Øª >= Ø­Ø¯_Ø§Ù„ØªØ£Ø®ÙŠØ±_Ù…Ù„ÙŠ_Ø«Ø§Ù†ÙŠØ©) {
                    ØªÙ†Ø¨ÙŠÙ‡_Ø§Ù„ØªØ£Ø®ÙŠØ±(inv);
                    Ø­Ø¯Ø«_ØªØ£Ø®ÙŠØ± = true;
                }
            }
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„ÙŠÙˆÙ… Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø´Ø§Ø´Ø© Ù†Ø´Ø·Ø©
        if (document.getElementById('today-log').classList.contains('active') || Ø­Ø¯Ø«_ØªØ£Ø®ÙŠØ±) {
            ØªØ­Ù…ÙŠÙ„_Ø³Ø¬Ù„_Ø§Ù„ÙŠÙˆÙ…();
        }
    }
    
    function Ù…Ù„Ø¡_Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®_Ø§Ù„Ù…ØªØ§Ø­Ø©() {
        const ÙÙˆØ§ØªÙŠØ± = Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„ÙÙˆØ§ØªÙŠØ±);
        const ÙÙ„ØªØ±Ø©_ØªØ­Ø¯ÙŠØ¯_Ø§Ù„ØªØ§Ø±ÙŠØ® = document.getElementById('filter-date');
        
        const Ø¬Ù…ÙŠØ¹_Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® = ÙÙˆØ§ØªÙŠØ±.map(inv => Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø³Ù„Ø³Ù„Ø©_ØªØ§Ø±ÙŠØ®_Ø§Ù„ÙØ§ØªÙˆØ±Ø©(inv));
        const Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®_Ø§Ù„ÙØ±ÙŠØ¯Ø© = [...new Set(Ø¬Ù…ÙŠØ¹_Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®)].sort().reverse(); 
        
        ÙÙ„ØªØ±Ø©_ØªØ­Ø¯ÙŠØ¯_Ø§Ù„ØªØ§Ø±ÙŠØ®.innerHTML = '<option value="">-- Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® --</option>';
        
        Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®_Ø§Ù„ÙØ±ÙŠØ¯Ø©.forEach(Ø³Ù„Ø³Ù„Ø©_Ø§Ù„ØªØ§Ø±ÙŠØ® => {
            const Ø®ÙŠØ§Ø± = document.createElement('option');
            Ø®ÙŠØ§Ø±.value = Ø³Ù„Ø³Ù„Ø©_Ø§Ù„ØªØ§Ø±ÙŠØ®;
            Ø®ÙŠØ§Ø±.textContent = Ø³Ù„Ø³Ù„Ø©_Ø§Ù„ØªØ§Ø±ÙŠØ®; 
            ÙÙ„ØªØ±Ø©_ØªØ­Ø¯ÙŠØ¯_Ø§Ù„ØªØ§Ø±ÙŠØ®.appendChild(Ø®ÙŠØ§Ø±);
        });
    }
    
    function Ø­Ø³Ø§Ø¨_Ù…Ù„Ø®Øµ_Ø§Ù„Ø£Ø¯Ø§Ø¡(Ø§Ù„ÙÙˆØ§ØªÙŠØ±) {
        let Ù…Ø¬Ù…ÙˆØ¹_ÙˆÙ‚Øª_Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² = 0;
        let Ù…Ø¬Ù…ÙˆØ¹_ÙÙˆØ§ØªÙŠØ±_Ù…ÙƒØªÙ…Ù„Ø© = 0;
        let Ù…Ø¬Ù…ÙˆØ¹_ÙÙˆØ§ØªÙŠØ±_Ù…ØªØ£Ø®Ø±Ø© = 0;
        let Ù…Ø¬Ù…ÙˆØ¹_Ø¯Ù‚Ø§Ø¦Ù‚_ØªØ£Ø®ÙŠØ± = 0; 

        Ø§Ù„ÙÙˆØ§ØªÙŠØ±.forEach(inv => {
            if (inv.isCompleted) {
                Ù…Ø¬Ù…ÙˆØ¹_ÙÙˆØ§ØªÙŠØ±_Ù…ÙƒØªÙ…Ù„Ø©++;
                Ù…Ø¬Ù…ÙˆØ¹_ÙˆÙ‚Øª_Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² += inv.timeToComplete;
                
                if (inv.timeToComplete > Ø­Ø¯_Ø§Ù„ØªØ£Ø®ÙŠØ±_Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚) {
                    Ù…Ø¬Ù…ÙˆØ¹_ÙÙˆØ§ØªÙŠØ±_Ù…ØªØ£Ø®Ø±Ø©++;
                    // Ù…Ø¬Ù…ÙˆØ¹ Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„ØªØ£Ø®ÙŠØ± Ø§Ù„ÙØ¹Ù„ÙŠ (Ø¥Ø°Ø§ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯)
                    Ù…Ø¬Ù…ÙˆØ¹_Ø¯Ù‚Ø§Ø¦Ù‚_ØªØ£Ø®ÙŠØ± += (inv.timeToComplete - Ø­Ø¯_Ø§Ù„ØªØ£Ø®ÙŠØ±_Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚); 
                }
            }
        });
        
        const Ù…ØªÙˆØ³Ø·_ÙˆÙ‚Øª_Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² = Ù…Ø¬Ù…ÙˆØ¹_ÙÙˆØ§ØªÙŠØ±_Ù…ÙƒØªÙ…Ù„Ø© > 0 ? (Ù…Ø¬Ù…ÙˆØ¹_ÙˆÙ‚Øª_Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² / Ù…Ø¬Ù…ÙˆØ¹_ÙÙˆØ§ØªÙŠØ±_Ù…ÙƒØªÙ…Ù„Ø©).toFixed(1) : '--';
        const Ù…ØªÙˆØ³Ø·_Ø¯Ù‚Ø§Ø¦Ù‚_ØªØ£Ø®ÙŠØ± = Ù…Ø¬Ù…ÙˆØ¹_ÙÙˆØ§ØªÙŠØ±_Ù…ØªØ£Ø®Ø±Ø© > 0 ? (Ù…Ø¬Ù…ÙˆØ¹_Ø¯Ù‚Ø§Ø¦Ù‚_ØªØ£Ø®ÙŠØ± / Ù…Ø¬Ù…ÙˆØ¹_ÙÙˆØ§ØªÙŠØ±_Ù…ÙƒØªÙ…Ù„Ø©).toFixed(1) : '0';

        document.getElementById('avg-tat').textContent = `${Ù…ØªÙˆØ³Ø·_ÙˆÙ‚Øª_Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²} Ø¯Ù‚ÙŠÙ‚Ø© (${Ù…Ø¬Ù…ÙˆØ¹_ÙÙˆØ§ØªÙŠØ±_Ù…ÙƒØªÙ…Ù„Ø©} Ø·Ù„Ø¨)`;
        document.getElementById('avg-delay').textContent = `${Ù…ØªÙˆØ³Ø·_Ø¯Ù‚Ø§Ø¦Ù‚_ØªØ£Ø®ÙŠØ±} Ø¯Ù‚ÙŠÙ‚Ø© (${Ù…Ø¬Ù…ÙˆØ¹_ÙÙˆØ§ØªÙŠØ±_Ù…ØªØ£Ø®Ø±Ø©} ØªØ£Ø®ÙŠØ±)`;
    }


    function ÙÙ„ØªØ±Ø©_Ø§Ù„ÙÙˆØ§ØªÙŠØ±() {
        const ØªØ§Ø±ÙŠØ®_Ø§Ù„ÙÙ„ØªØ±Ø© = document.getElementById('filter-date').value.trim();
        const Ù…ÙØ¹Ø±Ù_Ø§Ù„ÙÙ„ØªØ±Ø©_Ø¨Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© = document.getElementById('filter-crew-select').value.trim();
        const Ù…ÙØ¹Ø±Ù_Ø§Ù„ÙÙ„ØªØ±Ø©_Ø¨Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ = document.getElementById('filter-crew-id').value.trim().toUpperCase(); 
        
        let ÙÙˆØ§ØªÙŠØ± = Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„ÙÙˆØ§ØªÙŠØ±);
        
        let Ø§Ù„ÙÙˆØ§ØªÙŠØ±_Ø§Ù„Ù…ÙÙ„ØªØ±Ø© = ÙÙˆØ§ØªÙŠØ±;
        
        if (ØªØ§Ø±ÙŠØ®_Ø§Ù„ÙÙ„ØªØ±Ø©) {
            Ø§Ù„ÙÙˆØ§ØªÙŠØ±_Ø§Ù„Ù…ÙÙ„ØªØ±Ø© = Ø§Ù„ÙÙˆØ§ØªÙŠØ±_Ø§Ù„Ù…ÙÙ„ØªØ±Ø©.filter(inv => Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø³Ù„Ø³Ù„Ø©_ØªØ§Ø±ÙŠØ®_Ø§Ù„ÙØ§ØªÙˆØ±Ø©(inv) === ØªØ§Ø±ÙŠØ®_Ø§Ù„ÙÙ„ØªØ±Ø©);
        }
        
        let Ù…ÙØ¹Ø±Ù_Ù†Ù‡Ø§Ø¦ÙŠ_Ù„Ù„ÙÙ„ØªØ±Ø© = Ù…ÙØ¹Ø±Ù_Ø§Ù„ÙÙ„ØªØ±Ø©_Ø¨Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©;

        if (Ù…ÙØ¹Ø±Ù_Ø§Ù„ÙÙ„ØªØ±Ø©_Ø¨Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„) {
             Ù…ÙØ¹Ø±Ù_Ù†Ù‡Ø§Ø¦ÙŠ_Ù„Ù„ÙÙ„ØªØ±Ø© = Ù…ÙØ¹Ø±Ù_Ø§Ù„ÙÙ„ØªØ±Ø©_Ø¨Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„;
        }

        if (Ù…ÙØ¹Ø±Ù_Ù†Ù‡Ø§Ø¦ÙŠ_Ù„Ù„ÙÙ„ØªØ±Ø©) {
            Ø§Ù„ÙÙˆØ§ØªÙŠØ±_Ø§Ù„Ù…ÙÙ„ØªØ±Ø© = Ø§Ù„ÙÙˆØ§ØªÙŠØ±_Ø§Ù„Ù…ÙÙ„ØªØ±Ø©.filter(inv => inv.recipientID === Ù…ÙØ¹Ø±Ù_Ù†Ù‡Ø§Ø¦ÙŠ_Ù„Ù„ÙÙ„ØªØ±Ø©);
        }

        Ø¹Ø±Ø¶_Ø§Ù„ÙÙˆØ§ØªÙŠØ±(Ø§Ù„ÙÙˆØ§ØªÙŠØ±_Ø§Ù„Ù…ÙÙ„ØªØ±Ø©, '#invoices-log-table tbody', false); 
        Ø­Ø³Ø§Ø¨_Ù…Ù„Ø®Øµ_Ø§Ù„Ø£Ø¯Ø§Ø¡(Ø§Ù„ÙÙˆØ§ØªÙŠØ±_Ø§Ù„Ù…ÙÙ„ØªØ±Ø©); // ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡
        
        const Ø¹Ù†ØµØ±_Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª = document.getElementById('filtered-stats');
        const Ù†Øµ_Ø§Ù„ØªØ§Ø±ÙŠØ® = ØªØ§Ø±ÙŠØ®_Ø§Ù„ÙÙ„ØªØ±Ø© ? `Ø¨ØªØ§Ø±ÙŠØ®: ${ØªØ§Ø±ÙŠØ®_Ø§Ù„ÙÙ„ØªØ±Ø©}` : 'Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®';
        
        let Ù†Øµ_Ø§Ù„Ù…Ø¨Ø§Ø´Ø± = 'Ù„Ù„Ø¬Ù…ÙŠØ¹';
        if (Ù…ÙØ¹Ø±Ù_Ù†Ù‡Ø§Ø¦ÙŠ_Ù„Ù„ÙÙ„ØªØ±Ø©) {
            const Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙˆÙ† = Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†);
            const Ø§Ù„Ø¹Ø¶Ùˆ_Ø§Ù„Ù…Ø­Ø¯Ø¯ = Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙˆÙ†.find(Ù… => Ù….id === Ù…ÙØ¹Ø±Ù_Ù†Ù‡Ø§Ø¦ÙŠ_Ù„Ù„ÙÙ„ØªØ±Ø©);
            
            if (Ø§Ù„Ø¹Ø¶Ùˆ_Ø§Ù„Ù…Ø­Ø¯Ø¯) {
                Ù†Øµ_Ø§Ù„Ù…Ø¨Ø§Ø´Ø± = `Ù„Ù„Ù…Ø¨Ø§Ø´Ø±: ${Ø§Ù„Ø¹Ø¶Ùˆ_Ø§Ù„Ù…Ø­Ø¯Ø¯.name} (ID: ${Ø§Ù„Ø¹Ø¶Ùˆ_Ø§Ù„Ù…Ø­Ø¯Ø¯.id})`;
            } else {
                 Ù†Øµ_Ø§Ù„Ù…Ø¨Ø§Ø´Ø± = `Ù„Ù„Ù…Ø¨Ø§Ø´Ø± (ID): ${Ù…ÙØ¹Ø±Ù_Ù†Ù‡Ø§Ø¦ÙŠ_Ù„Ù„ÙÙ„ØªØ±Ø©} (Ø§Ø³Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„)`;
            }

        }

        Ø¹Ù†ØµØ±_Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª.textContent = `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${Ø§Ù„ÙÙˆØ§ØªÙŠØ±_Ø§Ù„Ù…ÙÙ„ØªØ±Ø©.length} ÙØ§ØªÙˆØ±Ø© Ù…ÙØ³Ø¬Ù„Ø© ${Ù†Øµ_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±} ${Ù†Øµ_Ø§Ù„ØªØ§Ø±ÙŠØ®}`;
    }

    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„Ø­Ù…Ø§ÙŠØ© ---

    function authenticateAndShowTab(tabId) {
        const pin = prompt('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©:');
        if (pin === ADMIN_PIN) {
            showTab(tabId);
        } else if (pin !== null) {
            alert('Ø±Ù…Ø² Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­.');
        }
    }
    
    function Ù…Ø³Ø­_Ø¬Ù…ÙŠØ¹_Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª() {
        if (confirm('ØªØ­Ø°ÙŠØ±! Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† PIN Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
            const pin = prompt('Ø¥Ø¬Ø±Ø§Ø¡ Ø®Ø·ÙŠØ±: Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ Ù„Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø³Ø­:');
            if (pin === ADMIN_PIN) {
                 localStorage.removeItem(Ù…ÙØªØ§Ø­_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†);
                 localStorage.removeItem(Ù…ÙØªØ§Ø­_Ø§Ù„ÙÙˆØ§ØªÙŠØ±);
                 alert('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.');
                 window.location.reload();
            } else {
                 alert('Ø±Ù…Ø² Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­. ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù…Ø³Ø­.');
            }
        }
    }


    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
            tab.style.display = 'none'; 
        });
        document.querySelectorAll('.tab').forEach(btn => {
            btn.classList.remove('active');
        });
        
        document.getElementById(tabId).classList.add('active');
        document.getElementById(tabId).style.display = 'block';

        const activeTabButton = document.getElementById('btn-' + tabId.replace('-', ''));
        if (activeTabButton) {
            activeTabButton.classList.add('active');
        }
        
        if (tabId === 'crew-management') {
            ØªØ­Ù…ÙŠÙ„_Ù‚Ø§Ø¦Ù…Ø©_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†();
        } else if (tabId === 'today-log') {
            ØªØ­Ù…ÙŠÙ„_Ø³Ø¬Ù„_Ø§Ù„ÙŠÙˆÙ…();
        } else if (tabId === 'performance-log') {
            ØªØ­Ù…ÙŠÙ„_Ù‚Ø§Ø¦Ù…Ø©_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†(); 
            Ù…Ù„Ø¡_Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®_Ø§Ù„Ù…ØªØ§Ø­Ø©();
            document.getElementById('filter-date').value = '';
            document.getElementById('filter-crew-select').value = '';
            document.getElementById('filter-crew-id').value = ''; 
            ÙÙ„ØªØ±Ø©_Ø§Ù„ÙÙˆØ§ØªÙŠØ±();
        }
    }

    function exportDataToCSV() {
        let ÙÙˆØ§ØªÙŠØ± = Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„ÙÙˆØ§ØªÙŠØ±);
        if (ÙÙˆØ§ØªÙŠØ±.length === 0) {
            alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.");
            return;
        }

        let Ù…Ø­ØªÙˆÙ‰_CSV = "data:text/csv;charset=utf-8,\uFEFF"; 
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø¤ÙˆØ³
        const Ø§Ù„Ø±Ø¤ÙˆØ³ = ["Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©", "Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©", "Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ID", "Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø§Ù„Ø§Ø³Ù…", "ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…", "Ø§Ù„Ø­Ø§Ù„Ø©", "Ù…Ø¯Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² (Ø¯Ù‚ÙŠÙ‚Ø©)", "Ù…ØªØ£Ø®Ø±ØŸ", "ÙˆÙ‚Øª Ø§Ù„Ø¥ØºÙ„Ø§Ù‚", "Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„"];
        Ù…Ø­ØªÙˆÙ‰_CSV += Ø§Ù„Ø±Ø¤ÙˆØ³.join(",") + "\r\n";

        ÙÙˆØ§ØªÙŠØ±.forEach(inv => {
            
            const Ù†Øµ_Ø§Ù„Ø­Ø§Ù„Ø© = inv.isCompleted ? "Ù…ØºÙ„Ù‚" : "Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°";
            const Ù†Øµ_ØªØ£Ø®ÙŠØ± = inv.wasDelayed === true ? "Ù†Ø¹Ù…" : "Ù„Ø§";

            const ØµÙ = [
                inv.invoiceNum,
                inv.tableNum,
                inv.recipientID,
                inv.recipientName,
                inv.timestamp.replace(/,/g, ' '),
                Ù†Øµ_Ø§Ù„Ø­Ø§Ù„Ø©,
                inv.timeToComplete || '',
                Ù†Øµ_ØªØ£Ø®ÙŠØ±,
                inv.completionTime || '',
                inv.modificationNote || ''
            ].map(item => {
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù‡ÙŠ Ø³Ù„Ø§Ø³Ù„ Ù†ØµÙŠØ© ÙˆØªØ¶Ù…ÙŠÙ†Ù‡Ø§ Ø¨Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù‚ØªØ¨Ø§Ø³ Ø¥Ø°Ø§ Ø§Ø­ØªÙˆØª Ø¹Ù„Ù‰ ÙÙˆØ§ØµÙ„
                const strItem = (item === null || item === undefined) ? '' : String(item);
                return `"${strItem.replace(/"/g, '""')}"`;
            }).join(",");
            
            Ù…Ø­ØªÙˆÙ‰_CSV += ØµÙ + "\r\n";
        });

        const encodedUri = encodeURI(Ù…Ø­ØªÙˆÙ‰_CSV);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", `Invoices_Log_Andalus_${new Date().toISOString().slice(0, 10)}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
    
    function printInvoicesLog() {
        window.print();
    }


    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    document.addEventListener('DOMContentLoaded', () => {
        if (Ø§Ù„Ø­ØµÙˆÙ„_Ø¹Ù„Ù‰_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†).length === 0) {
            Ø­ÙØ¸_Ø§Ù„Ø¹Ù†Ø§ØµØ±(Ù…ÙØªØ§Ø­_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†, [
                { name: "Ø¹Ù„ÙŠ", id: "A01" },
                { name: "Ø¨Ø¯Ø±", id: "B02" },
                { name: "Ø³Ø§Ù„Ù…", id: "S03" }
            ]);
        }
        ØªØ­Ù…ÙŠÙ„_Ù‚Ø§Ø¦Ù…Ø©_Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†();
        showTab('invoice-entry');
        Ù…Ù„Ø¡_Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®_Ø§Ù„Ù…ØªØ§Ø­Ø©();
        
        Ø¨Ø¯Ø¡_Ù…Ø±Ø§Ù‚Ø¨_Ø§Ù„ØªØ£Ø®ÙŠØ±(); 
    });

</script>
</body>
</html>
